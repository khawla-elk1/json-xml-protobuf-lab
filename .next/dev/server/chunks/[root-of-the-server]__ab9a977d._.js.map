{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 34, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/Khawla/Desktop/TP/Comparer%20JSON%2C%20XML%20et%20Protobuf/json-xml-protobuf-lab/pages/api/serialize.js"],"sourcesContent":["import fs from 'fs';\r\nimport path from 'path';\r\nimport xmljs from 'xml-js';\r\nimport { employeeData } from '../../lib/data';\r\n// Importation du code généré par Protobuf\r\nimport { EmployeeList } from '../../src/pb/employee_pb'; \r\n\r\n// Chemin pour sauvegarder les fichiers dans le dossier public\r\nconst outputDir = path.join(process.cwd(), 'public', 'serialized');\r\n\r\nexport default async function handler(req, res) {\r\n  if (req.method !== 'POST') {\r\n    return res.status(405).json({ message: 'Method Not Allowed' });\r\n  }\r\n\r\n  // 1. Assurer que le répertoire de sortie existe\r\n  if (!fs.existsSync(outputDir)) {\r\n    fs.mkdirSync(outputDir, { recursive: true });\r\n  }\r\n\r\n  const results = {};\r\n\r\n  // --- Sérialisation JSON ---\r\n  try {\r\n    const jsonString = JSON.stringify({ employees: employeeData }, null, 2);\r\n    const jsonPath = path.join(outputDir, 'employees.json');\r\n    fs.writeFileSync(jsonPath, jsonString);\r\n    results.json = { \r\n      size: fs.statSync(jsonPath).size, \r\n      fileName: 'employees.json' \r\n    };\r\n  } catch (error) {\r\n    console.error(\"JSON Error:\", error);\r\n    results.json = { error: \"Failed to serialize JSON\" };\r\n  }\r\n\r\n  // --- Sérialisation XML ---\r\n  try {\r\n    const xmlData = {\r\n      _declaration: { _attributes: { version: '1.0', encoding: 'utf-8' } },\r\n      EmployeeList: {\r\n        Employee: employeeData.map(emp => ({\r\n          id: { _text: emp.id },\r\n          name: { _text: emp.name },\r\n          department: { _text: emp.department },\r\n          salary: { _text: emp.salary }\r\n        }))\r\n      }\r\n    };\r\n    const xmlString = xmljs.js2xml(xmlData, { compact: true, spaces: 2 });\r\n    const xmlPath = path.join(outputDir, 'employees.xml');\r\n    fs.writeFileSync(xmlPath, xmlString);\r\n    results.xml = { \r\n      size: fs.statSync(xmlPath).size, \r\n      fileName: 'employees.xml' \r\n    };\r\n  } catch (error) {\r\n    console.error(\"XML Error:\", error);\r\n    results.xml = { error: \"Failed to serialize XML\" };\r\n  }\r\n\r\n  // --- Sérialisation Protobuf ---\r\n  try {\r\n    // 1. Créer une instance du message EmployeeList\r\n    const message = EmployeeList.create({ employees: employeeData });\r\n\r\n    // 2. Encoder le message en un buffer binaire (Uint8Array)\r\n    const buffer = EmployeeList.encode(message).finish();\r\n\r\n    const protoPath = path.join(outputDir, 'employees.bin');\r\n    fs.writeFileSync(protoPath, buffer);\r\n    results.protobuf = { \r\n      size: fs.statSync(protoPath).size, \r\n      fileName: 'employees.bin' \r\n    };\r\n  } catch (error) {\r\n    console.error(\"Protobuf Error:\", error);\r\n    results.protobuf = { error: \"Failed to serialize Protobuf\" };\r\n  }\r\n  \r\n  // 3. Retourner les résultats\r\n  res.status(200).json(results);\r\n}"],"names":[],"mappings":";;;;AAAA;AACA;AACA;;;;;;;;;;;;;;;;AAKA,8DAA8D;AAC9D,MAAM,YAAY,4GAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI,UAAU;AAEtC,eAAe,QAAQ,GAAG,EAAE,GAAG;IAC5C,IAAI,IAAI,MAAM,KAAK,QAAQ;QACzB,OAAO,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;YAAE,SAAS;QAAqB;IAC9D;IAEA,gDAAgD;IAChD,IAAI,CAAC,wGAAE,CAAC,UAAU,CAAC,YAAY;QAC7B,wGAAE,CAAC,SAAS,CAAC,WAAW;YAAE,WAAW;QAAK;IAC5C;IAEA,MAAM,UAAU,CAAC;IAEjB,6BAA6B;IAC7B,IAAI;QACF,MAAM,aAAa,KAAK,SAAS,CAAC;YAAE,WAAW;QAAa,GAAG,MAAM;QACrE,MAAM,WAAW,4GAAI,CAAC,IAAI,CAAC,WAAW;QACtC,wGAAE,CAAC,aAAa,CAAC,UAAU;QAC3B,QAAQ,IAAI,GAAG;YACb,MAAM,wGAAE,CAAC,QAAQ,CAAC,UAAU,IAAI;YAChC,UAAU;QACZ;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,eAAe;QAC7B,QAAQ,IAAI,GAAG;YAAE,OAAO;QAA2B;IACrD;IAEA,4BAA4B;IAC5B,IAAI;QACF,MAAM,UAAU;YACd,cAAc;gBAAE,aAAa;oBAAE,SAAS;oBAAO,UAAU;gBAAQ;YAAE;YACnE,cAAc;gBACZ,UAAU,aAAa,GAAG,CAAC,CAAA,MAAO,CAAC;wBACjC,IAAI;4BAAE,OAAO,IAAI,EAAE;wBAAC;wBACpB,MAAM;4BAAE,OAAO,IAAI,IAAI;wBAAC;wBACxB,YAAY;4BAAE,OAAO,IAAI,UAAU;wBAAC;wBACpC,QAAQ;4BAAE,OAAO,IAAI,MAAM;wBAAC;oBAC9B,CAAC;YACH;QACF;QACA,MAAM,YAAY,sHAAK,CAAC,MAAM,CAAC,SAAS;YAAE,SAAS;YAAM,QAAQ;QAAE;QACnE,MAAM,UAAU,4GAAI,CAAC,IAAI,CAAC,WAAW;QACrC,wGAAE,CAAC,aAAa,CAAC,SAAS;QAC1B,QAAQ,GAAG,GAAG;YACZ,MAAM,wGAAE,CAAC,QAAQ,CAAC,SAAS,IAAI;YAC/B,UAAU;QACZ;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,cAAc;QAC5B,QAAQ,GAAG,GAAG;YAAE,OAAO;QAA0B;IACnD;IAEA,iCAAiC;IACjC,IAAI;QACF,gDAAgD;QAChD,MAAM,UAAU,aAAa,MAAM,CAAC;YAAE,WAAW;QAAa;QAE9D,0DAA0D;QAC1D,MAAM,SAAS,aAAa,MAAM,CAAC,SAAS,MAAM;QAElD,MAAM,YAAY,4GAAI,CAAC,IAAI,CAAC,WAAW;QACvC,wGAAE,CAAC,aAAa,CAAC,WAAW;QAC5B,QAAQ,QAAQ,GAAG;YACjB,MAAM,wGAAE,CAAC,QAAQ,CAAC,WAAW,IAAI;YACjC,UAAU;QACZ;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,mBAAmB;QACjC,QAAQ,QAAQ,GAAG;YAAE,OAAO;QAA+B;IAC7D;IAEA,6BAA6B;IAC7B,IAAI,MAAM,CAAC,KAAK,IAAI,CAAC;AACvB"}}]
}